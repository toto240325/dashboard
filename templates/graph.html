<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>My Title</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1"></script>

    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.2.1/chartjs-plugin-zoom.min.js"></script>

    <style type="text/css">
        .chartBox2 {
            width: 400px;
        }

        .chartBox {
            width: "900";
            height: "100";
        }
    </style>

    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/samples">Samples</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Dropdown
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/">Home</a></li>
                            <li><a class="dropdown-item" href="/about">About</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link disabled">Disabled</a>
                    </li> -->
                </ul>
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>


    <button type="button" onclick="alert('Hello world!')">Click Me!</button>

    <div class="chartBox">
        <canvas id="canvas_frigo_with_smart" width="900" height="350" style="border:1px solid #d3d3d3;"></canvas>
    </div>

    <!-- <div class="chartBox">
        <canvas id="canvas_frigo_10h" width="900" height="350"></canvas>
    </div> -->

    <canvas id="canvas_frigo_24h" width="900" height="250"></canvas>

    <canvas id="canvas_pool_ph" width="900" height="300"></canvas>

    <canvas id="canvas_pool_cl" width="900" height="300"></canvas>

    <canvas id="canvas_pool_ph_cl" width="900" height="300"></canvas>

    <canvas id="canvas_power_day" width="900" height="300"></canvas>

    <canvas id="canvas_power_night" width="900" height="300"></canvas>

    <canvas id="canvas_power_day_delta" width="900" height="300"></canvas>

    <canvas id="canvas_power_night_delta" width="900" height="300"></canvas>

    <canvas id="canvas_ps4" width="900" height="300"></canvas>

    <canvas id="canvas_ps4_2" width="900" height="300"></canvas>

    <canvas id="canvas_bar" width="900" height="300"></canvas>

<script>

        var config_canvas_bar = {
            type: 'bar',
            data: barChartData,
            options: {
                elements: {
                    rectangle: {
                        borderWidth: 2,
                        borderColor: 'rgb(0, 255, 0)',
                        borderSkipped: 'bottom'
                    }
                },
                responsive: true,
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Chart.js Bar Chart'
                },
                scales: {
                    xAxes: {
                        // grid: {
                        //     color: (context) => {
                        //         console.log("context.tick : %o",context);
                        //         // if (context.tick.value === 12) {
                        //         //     return 'rgba(75,192,192,1)';
                        //         // } else {
                        //         //     return 'rgba(0,0,0,0.1)';
                        //         // }
                        //     }
                        // },
                        type: 'time',
                        offset: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Year-Month'
                        },
                        time: {
                            // min: '2014-12-01' ,
                            // max: '2015-12-01',
                            unit: 'month',
                            displayFormats: {
                                month: "MMM yy"
                            }
                        },
                        gridLines: {
                            offsetGridLines: false,
                            drawTicks: true,
                            display: true
                        },
                        stacked: true
                    },
                    yAxes: {
                        ticks: {
                            beginAtZero: true
                        },
                        stacked: true
                    }
                }
            }
        };

        var barChartData = {
            labels: ["2015-01-01", "2015-02-01", "2015-03-01", "2015-04-01", "2015-05-01", "2015-07-01"],
            datasets: [{/*from  w w w  . de mo 2 s . com*/
                categoryPercentage: .5,
                barPercentage: 1,
                label: 'Dataset 1',
                backgroundColor: "rgba(220,220,220,0.5)",
                data: [10, 4, 5, 7, 2, 3]
            }]
        };
        var ctx = document.getElementById("canvas_bar").getContext("2d");
        var my_bar_chart = new Chart(ctx, config_canvas_bar);

        var canvas_bar = document.getElementById("canvas_bar");
        canvas_bar.onclick = function (evt) {
            index = 2;
            console.log("my_bar_chart : %o", my_bar_chart);
            console.log("my_bar_chart.data: %o", my_bar_chart.data);
            alert("test");
            console.log("popping index %i", index);
            console.log("popping element with value %i and label %s", my_bar_chart.data.datasets[0].data[index], my_bar_chart.data.datasets[0].label[index]);
            console.log('before : datasets[0].data : %', my_bar_chart.data.datasets[0].data);
            //console.log("popped : %o", my_bar_chart.data.datasets[0].data.pop(index));
            console.log("splicing");
            var spliced = my_bar_chart.data.datasets[0].data.splice(index, 1);
            var spliced = my_bar_chart.data.labels.splice(index, 1);
            console.log("index : %o", index);

            // datasets[0].data.pop(index);
            console.log('after : datasets[0].data : %', my_bar_chart.data.datasets[0].data);
            my_bar_chart.update();
            console.log("chart updated ?");
        };

    </script>

    <canvas id="canvas_bar2" width="900" height="300"></canvas>
    <!-- <script>
        const dailyStock = [
            { x: "2017-07-25", y: 1 },
            { x: "2017-08-25", y: 3 },
            { x: "2017-09-10", y: 7 },
            { x: "2017-09-28", y: 0 },
            { x: "2017-10-02", y: 3 },
            { x: "2017-10-24", y: 2 },
            { x: "2017-12-01", y: 1 },
            { x: "2017-12-30", y: 0 },
        ];

        const monthlyTotal = [
            { x: "2017-08-01", y: 1 },
            { x: "2017-09-01", y: 10 },
            { x: "2017-10-01", y: 5 },
            { x: "2017-12-01", y: 6 },
        ];

        var config_canvas_bar2 = {
            type: "bar",
            data: {
                //labels: ["2017-08", "2017-09", "2017-10", "2017-11", "2017-12"],
                datasets: [
                    {
                        barPercentage: .7,
                        // xAxisID: "bar",
                        // label: "sales",
                        data: monthlyTotal,
                        // backgroundColor: "green",
                        // borderColor: "black",
                        // borderWidth: 1,
                        // width: 55,
                        // order: 2,
                    },
                    {
                        label: "stock",
                        type: "line",
                        data: dailyStock,
                        backgroundColor: "orange",
                        borderColor: "orange",
                        fill: false,
                        order: 1,
                    },
                ],
            },
            options: {
                scales: {
                    xAxes: {
                        grid: {
                            color: (context) => {
                                // console.log("context.tick : %o",context);
                                // if (context.tick.value === 12) {
                                //     return 'rgba(75,192,192,1)';
                                // } else {
                                //     return 'rgba(0,0,0,0.1)';
                                //      return 'green';
                                // }
                            }
                        },
                        // gridLines: {
                        //     // offsetGridLines: false,
                        //     drawTicks: true,
                        //     display: true
                        // },

                        // id: "line",
                        type: "time",
                        // time: {
                        //     unit: "month",
                        //     displayFormats: {
                        //         month: "MMM",
                        //     },
                        // },
                        // distribution: "linear",
                    },
                    // {
                    //     id: "bar",
                    //     offset: true,
                    //     type: "category",
                    //     distribution: "series",
                    // }
                    yAxes: {
                        ticks: {
                            beginAtZero: true,
                        },
                    },
                },
                plugins: {
                    zoom: zoom_plugin
                }
            },
        };

        var ctx = document.getElementById("canvas_bar2").getContext("2d");
        var myChart = new Chart(ctx, config_canvas_bar2);

        // allows to swipe up and down on smartPhone/touchScreen
        lineChart_frigo_10h.canvas.style.touchAction = "pan-y";

    </script>
 -->

    <canvas id="canvas_bar3" width="900" height="300"></canvas>
    <!-- <script>
        const dailyStock2 = [
            { x: "2017-08-02 10:00", y: 1 },
            { x: "2017-08-02 11:00", y: 3 },
            { x: "2017-08-02 15:00", y: 7 },
            { x: "2017-08-03 09:00", y: 0 },
            { x: "2017-08-03 10:00", y: 3 },
            { x: "2017-08-03 10:30", y: 2 },
            { x: "2017-08-04 10:45", y: 1 },
            { x: "2017-08-10 17:00", y: 0 },
        ];

        const monthlyTotal2 = [
            { x: "2017-08-02", y: 1 },
            { x: "2017-08-03", y: 10 },
            { x: "2017-08-04", y: 5 },
            { x: "2017-08-10", y: 5 },
        ];

        var ctx2 = document.getElementById("canvas_bar3").getContext("2d");
        var myChart2 = new Chart(ctx2, {
            type: "bar",
            data: {
                labels: ["2017-08-02", "2017-08-03", "2017-08-04", "2017-08-10"],
                datasets: [
                    {
                        barPercentage: .7,
                        xAxisID: "bar",
                        label: "sales",
                        data: monthlyTotal2,
                        backgroundColor: "green",
                        borderColor: "black",
                        borderWidth: 1,
                        width: 55,
                        order: 2,
                    },
                    {
                        label: "stock",
                        type: "line",
                        data: dailyStock2,
                        backgroundColor: "orange",
                        borderColor: "orange",
                        fill: false,
                        order: 1,
                    },
                ],
            },
            options: {
                scales: {
                    xAxes: {
                        id: "line",
                        type: "time",
                        time: {
                            unit: "day",
                            displayFormats: {
                                month: "DD",
                            },
                        },
                        distribution: "linear",
                    },
                    // {
                    //     id: "bar",
                    //     offset: true,
                    //     type: "category",
                    //     distribution: "series",
                    // }
                    yAxes:
                    {
                        ticks: {
                            beginAtZero: true,
                        },
                    },
                },
            },
        });
    </script> -->


    <canvas id="canvas_ps4_2_datasets" width="900" height="300"></canvas>
    <!-- <script>
        title = "{{ ps4_2_datasets_chart.title|safe }}"
        values1 = JSON.parse('{{ ps4_2_datasets_chart.values1 | tojson }}');
        labels1 = JSON.parse('{{ ps4_2_datasets_chart.labels1 | tojson }}');
        // labels1 = {{ ps4_2_datasets_chart.labels1 | safe }}
        // values1 = {{ ps4_2_datasets_chart.values1 | safe }}
        chart_type1 = "{{ ps4_2_datasets_chart.chart_type1|safe }}"

        values2 = JSON.parse('{{ ps4_2_datasets_chart.values2 | tojson }}');
        labels2 = JSON.parse('{{ ps4_2_datasets_chart.labels2 | tojson }}');
        // labels2 = {{ ps4_2_datasets_chart.labels2 | safe }}
        // values2 = {{ ps4_2_datasets_chart.values2 | safe }}
        chart_type2 = "{{ ps4_2_datasets_chart.chart_type2|safe }}"

        unit = "{{ ps4_2_datasets_chart.unit|safe }}"

        config = myConfig_2_datasets(
            title,
            labels1, values1, chart_type1,
            labels2, values2, chart_type2,
            unit);
        //console.log(config);

        var ctx = document.getElementById("canvas_ps4_2_datasets").getContext("2d");
        var lineChart = new Chart(ctx, config);
    </script>
 -->
    <!-- <canvas id="canvas3"></canvas>
    <script>
        var timeFormat = 'dd/MM/yyyy';
        var data31 = [{
            x: "04/01/2014", y: 175
        }, {
            x: "10/01/2014", y: 175
        }, {
            x: "04/01/2015", y: 178
        }, {
            x: "10/01/2015", y: 178
        }];

        var data3 = {
            datasets: [
                {
                    label: "US Dates",
                    data: data31,
                    fill: false,
                    borderColor: 'red'
                },
                {
                    label: "UK Dates2 ",
                    data: [{
                        x: "01/04/2014", y: 175
                    }, {
                        x: "01/10/2014", y: 175
                    }, {
                        x: "01/04/2015", y: 178
                    }, {
                        x: "01/10/2015", y: 178
                    }],
                    fill: false,
                    borderColor: 'blue'
                }
            ]
        };
        // console.log(data3);
        var options3 = {
            responsive: true,
            title: {
                display: true,
                text: "Chart.js Time Scale"
            },
            scales: {
                xAxes: {
                    type: "time",
                    time: {
                        format: timeFormat,
                        // tooltipFormat: 'll'
                    },
                    scaleLabel: {
                        display: true,
                        labelString: 'Date3'
                    }
                },
                yAxes: {
                    scaleLabel: {
                        display: true,
                        labelString: 'value'
                    }
                }
            }
        };
        var config3 = {
            type: 'line',
            data: data3,
            options: options3
            // options: {}
        };

        // -------------------------
        //         const labels3 = [
        //             'January',
        //             'February',
        //             'March',
        //             'April',
        //             'May',
        //             'June',
        //             ];
        //         const data3 = {
        //             labels: labels3,
        //             datasets: [{
        //                 label: 'My First dataset',
        //                 backgroundColor: 'rgb(255, 99, 132)',
        //                 borderColor: 'rgb(255, 99, 132)',
        //                 data: [0, 10, 5, 2, 20, 30, 45],
        //             }]
        //         };
        //         const config3 = {
        //             type: 'line',
        //             data: data3,
        //             options: {}
        //             };

        const myChart3 = new Chart(
            document.getElementById('canvas3'),
            config3
        );

        // var mycanvas3 = document.getElementById("canvas3");
        // mycanvas3.onclick = function (evt) {
        //     var activePoints = myChart3.getElementsAtEvent(evt);
        //     if (activePoints[0]) {
        //         console.log("start");
        //         obj = activePoints[0];
        //         console.log('Item: %o', obj);
        //         var chartData = activePoints[0]['_chart'].config.data;
        //         console.log('chartData: %o', chartData);
        //         var idx = activePoints[0]['_index'];
        //         console.log('idx: %o', idx);
        //         var label = chartData.labels[idx];
        //         console.log('label: %o', label);
        //         var value = chartData.datasets[0].data[idx];
        //         console.log('value: %o', value);

        //         var url = "http://example.com/?label=" + label + "&value=" + value;
        //         // console.log(url);
        //         // alert(url);
        //     }
        // };

    </script>
 -->

    <!-- <div style="width:75%;"><canvas id="canvas5"></canvas>
    </div>
    <script>
        data5 = [{ id: 'Sales', value: 1500 }, { id: 'Purchases', value: 500 }, { id: 'Purchases', value: 100 }, { id: 'Purchases', value: 300 }]
        const config5 = {
            type: 'line',
            data: {
                datasets: [{
                    data: data5.map(o => o.value)
                }]
            },
            options: {
                parsing: {
                    xAxisKey: 'id',
                    yAxisKey: 'nested.value'
                }
            }
        };

        const myChart5 = new Chart(
            document.getElementById('canvas5'),
            config5
        );
        var mycanvas = document.getElementById("canvas5");
        console.log('Item: %o', mycanvas);
        mycanvas.onclick = function (evt) {
            console.log("chart5 clicked !");
            console.log('mychart5: %o', myChart4);
            var activePoints = myChart5.getElementsAtEvent(evt);
            if (activePoints[0]) {
                console.log("start");
                obj = activePoints[0];
                console.log('Item: %o', obj);
                var chartData = activePoints[0]['_chart'].config.data;
                console.log('chartData: %o', chartData);
                var idx = activePoints[0]['_index'];
                console.log('idx: %o', idx);
                var label = chartData.labels[idx];
                console.log('label: %o', label);
                var value = chartData.datasets[0].data[idx];
                console.log('value: %o', value);

                var url = "http://example.com/?label=" + label + "&value=" + value;
                // console.log(url);
                // alert(url);
            }
        };

    </script> -->

    <!-- you need to include js code like this in order for jinja2 to be able to substitute some values passed from Flask -->
    {% block javascript %}
    <script type="text/javascript">
        {% include "mycharts.js" %}
    </script>
    {% endblock %}

</body>

</html>