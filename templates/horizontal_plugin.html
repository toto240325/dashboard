<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>

  <!-- <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.6/Chart.bundle.min.js"></script> -->

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.8.0"></script>


<script type="text/javascript">
    $(window).load(function () {//from  www  . j a  va  2 s  .  c  o  m
      var canvas = document.getElementById("myChart");
      var ctx = canvas.getContext("2d");

      const horizontalLinePlugin = {
        id: 'horizontalLinePlugin',
        // afterDraw: function (chartInstance) {
        beforeDraw(chartInstance) {
          // alert("test2");
          var yScale = chartInstance.scales["y"];
          var canvas = chartInstance.canvas;
          var ctx = chartInstance.ctx;
          var index;
          var line;
          var style;
          if (chartInstance.options.horizontalLine) {
            for (index = 0; index < chartInstance.options.horizontalLine.length; index++) {

              line = chartInstance.options.horizontalLine[index];
              console.log("line : %o", line);
              console.log("line y : %o", line.y);
              
              if (!line.style) {
                style = "rgba(169,169,169, .6)";
              } else {
                style = line.style;
              }
              if (line.y) {
                yValue = yScale.getPixelForValue(line.y);
              } else {
                yValue = 0;
              }
              ctx.lineWidth = 3;
              if (yValue) {
                ctx.beginPath();
                ctx.moveTo(0, yValue);
                ctx.lineTo(canvas.width, yValue);
                ctx.strokeStyle = style;
                ctx.stroke();
              }
              if (line.text) {
                ctx.fillStyle = style;
                ctx.fillText(line.text, 0, yValue + ctx.lineWidth);
              }
            }
            return;
          };
        }
      };

      const verticalLinePlugin = {
        id: 'verticalLinePlugin',
        // afterDraw: function (chartInstance) {
        afterDraw(chartInstance) {
          // alert("test2");
          var xScale = chartInstance.scales["x"];
          var canvas = chartInstance.canvas;
          var ctx = chartInstance.ctx;
          var index;
          var line;
          var style;
          if (chartInstance.options.verticalLine) {
            for (index = 0; index < chartInstance.options.verticalLine.length; index++) {

              line = chartInstance.options.verticalLine[index];
              console.log("line : %o", line);
              console.log("line x : %o", line.x);
              
              if (!line.style) {
                style = "rgba(169,169,169, .6)";
              } else {
                style = line.style;
              }
              if (line.x) {
                xValue = xScale.getPixelForValue(line.x);
              } else {
                xValue = 0;
              }
              ctx.lineWidth = 2;
              if (xValue) {
                ctx.beginPath();
                ctx.moveTo(xValue, 0);
                ctx.lineTo(xValue, canvas.height);
                ctx.strokeStyle = style;
                ctx.stroke();
              }
              if (line.text) {
                ctx.fillStyle = style;
                ctx.fillText(line.text, xValue + ctx.lineWidth, 10);
              }
            }
            return;
          };
        }
      };


      // Chart.pluginService.register(horizontalLinePlugin);

      // Chart.register({
      //   // plugin implementation
      //   id: 'pbefore', beforeInit: function (chart, args, options) {
      //     //..
      //     // alert("plugin beforeInit !");
      //   }
      // });

      var data = {
        labels: ["January", "February", "March", "April", "May", "June", "July"],
        datasets: [{
          label: "My First dataset",
          fill: false,
          lineTension: 0.1,
          backgroundColor: "rgba(75,192,192,0.4)",
          borderColor: "rgba(75,192,192,1)",
          borderCapStyle: 'butt',
          borderDash: [],
          borderDashOffset: 0.0,
          borderJoinStyle: 'miter',
          pointBorderColor: "rgba(75,192,192,1)",
          pointBackgroundColor: "#fff",
          pointBorderWidth: 1,
          pointHoverRadius: 5,
          pointHoverBackgroundColor: "rgba(75,192,192,1)",
          pointHoverBorderColor: "rgba(220,220,220,1)",
          pointHoverBorderWidth: 2,
          pointRadius: 1,
          pointHitRadius: 10,
          data: [65, 59, 80, 81, 56, 55, 40],
        }]
      };

      var config = {
        type: 'line',
        data: data,
        options: {
          title: {
            text: "test 1",
            display: true
          },
        },
        // plugins: [horizontalLinePlugin]
        // plugins: [{
        //   id: 'pafter', afterInit: function (chart, args, options) {
        //     //..
        //     // alert("plugin afterInit !");
        //   }
        // }]
      };

      options_horizontalLine = [{
        "y": 82,
        "style": "rgba(255, 0, 0, .4)",
        "text": "max"
      }, {
        "y": 60,
        "style": "#00ffff",
      }, {
        "y": 44,
        "text": "min"
      }];

      options_verticalLine = [{
        "x": "April",
        "style": "rgba(255, 0, 0, .4)",
        "text": "max"
      }, {
        "x": "May",
        "text": "min"
      }];

      config.options.horizontalLine = options_horizontalLine;
      config.options.verticalLine = options_verticalLine;
      // config.plugins = [horizontalLinePlugin];
      config.plugins = [verticalLinePlugin];

      console.log("config : %o", config);
      var myChart = new Chart(ctx, config);
    });



  </script>
</head>

<body>
  <canvas id="myChart" width="400" height="200"></canvas>
</body>

</html>